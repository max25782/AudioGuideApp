# План реализации аудиогида

## Этап 1: Работа с SQLite ✅

### Реализовано:
- ✅ Создание базы данных `audioguide.db`
- ✅ Таблица `points_of_interest` с полями: id, title, description, latitude, longitude, category, audioFilePath
- ✅ Вставка тестовых данных (4 точки интереса)
- ✅ Методы для работы с базой данных:
  - `getAllPoints()` - получение всех точек
  - `getPointsByCategory(category)` - фильтрация по категориям
  - `getNearestPoints(lat, lon, limit)` - ближайшие точки
  - `getPointsInRadius(lat, lon, radius)` - точки в радиусе
  - `getCategories()` - список категорий

### Формула расчета расстояния:
```sql
(6371 * acos(cos(radians(?)) * cos(radians(latitude)) * 
 cos(radians(longitude) - radians(?)) + 
 sin(radians(?)) * sin(radians(latitude)))) AS distance
```

## Этап 2: GPS-триггеры ✅

### Реализовано:
- ✅ Запрос разрешений на геолокацию
- ✅ Получение текущего местоположения
- ✅ Отслеживание местоположения в реальном времени
- ✅ Расчет расстояния до точек интереса
- ✅ Автоматическое срабатывание при входе в радиус 150 метров
- ✅ Предотвращение повторных срабатываний (Set для отслеживания)

### Алгоритм работы:
1. Запуск отслеживания каждые 5 секунд
2. Обновление при перемещении на 10+ метров
3. Проверка всех точек в радиусе 150 метров
4. Вызов callback-функции при обнаружении новой точки
5. Очистка списка активированных точек при выходе из радиуса

## Этап 3: Аудиоплеер ✅

### Реализовано:
- ✅ Загрузка аудиофайлов из `assets/audio/`
- ✅ Воспроизведение, пауза, остановка
- ✅ Обработка событий воспроизведения
- ✅ Управление громкостью и позицией
- ✅ Получение длительности и текущей позиции

### Поддерживаемые форматы:
- MP3, WAV, M4A, AAC

### Методы:
- `loadAudio(filePath)` - загрузка файла
- `playAudio()` - воспроизведение
- `pauseAudio()` - пауза
- `stopAudio()` - остановка
- `setVolume(volume)` - громкость
- `seekTo(position)` - перемотка

## Этап 4: Интеграция с Waze ✅

### Реализовано:
- ✅ Deep linking для открытия Waze
- ✅ Проверка установки Waze
- ✅ Fallback на Google Maps
- ✅ Навигация к точкам интереса

### URL схемы:
- `waze://?ll=LAT,LON&navigate=yes` - навигация
- `waze://?ll=LAT,LON&navigate=no` - просмотр карты
- `waze://?q=QUERY` - поиск

## Этап 5: Интерфейс ✅

### Реализовано:
- ✅ Карта с маркерами точек интереса
- ✅ Фильтр категорий с цветовой кодировкой
- ✅ Список ближайших точек
- ✅ Кнопки воспроизведения и навигации
- ✅ Адаптивный дизайн

### Компоненты:
- `MapView` - интерактивная карта
- `CategoryFilter` - фильтр категорий
- `PointsList` - список точек
- `HomeScreen` - главный экран

## Следующие этапы разработки

### Этап 6: Улучшения интерфейса
- [ ] Добавить экран детальной информации о точке
- [ ] Реализовать полноэкранный аудиоплеер
- [ ] Добавить анимации и переходы
- [ ] Улучшить дизайн карты (кастомные маркеры)

### Этап 7: Дополнительные функции
- [ ] Кэширование карт для оффлайн использования
- [ ] Создание пользовательских маршрутов
- [ ] Система уведомлений
- [ ] Статистика посещений

### Этап 8: Оптимизация
- [ ] Оптимизация производительности карты
- [ ] Улучшение точности GPS-триггеров
- [ ] Кэширование аудиофайлов
- [ ] Сжатие базы данных

### Этап 9: Тестирование
- [ ] Unit тесты для сервисов
- [ ] Integration тесты
- [ ] E2E тесты
- [ ] Тестирование на реальных устройствах

### Этап 10: Развертывание
- [ ] Настройка CI/CD
- [ ] Подготовка к публикации в App Store/Google Play
- [ ] Создание иконок и сплэш-скринов
- [ ] Документация для пользователей

## Технические детали

### Структура базы данных:
```sql
CREATE TABLE points_of_interest (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  latitude REAL NOT NULL,
  longitude REAL NOT NULL,
  category TEXT NOT NULL,
  audioFilePath TEXT NOT NULL
);
```

### Категории точек:
- Исторический (#4ECDC4)
- Религиозный (#45B7D1)
- Детский (#96CEB4)
- Природный (#FFEAA7)

### GPS-настройки:
- Точность: High
- Интервал обновления: 5 секунд
- Минимальное расстояние: 10 метров
- Радиус срабатывания: 150 метров

### Аудио-настройки:
- Формат: MP3 (рекомендуется)
- Качество: 128-256 kbps
- Размер: до 10 МБ
- Длительность: 1-5 минут

## Возможные проблемы и решения

### Проблема: Неточность GPS
**Решение:** Использование фильтра Калмана, усреднение координат

### Проблема: Большие аудиофайлы
**Решение:** Сжатие, потоковое воспроизведение

### Проблема: Высокое потребление батареи
**Решение:** Оптимизация интервалов обновления GPS

### Проблема: Отсутствие интернета
**Решение:** Полная оффлайн работа, кэширование данных 